<!DOCTYPE html>
<html>
<head>
  <title>Authenticating...</title>
  <!-- Using a known stable version of the Teams SDK -->
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"
    xintegrity="sha384-QtTBFeFlfRDZBfwCAeASrTqYHvIeL0iNfi3iGqG9D+ps24iZfK/L3tT4v9+VRUnI"
    crossorigin="anonymous"></script>
</head>
<body>
  <p>Please wait while we complete your sign-in...</p>
  <script>
    // This script runs inside the Teams-managed authentication popup.
    microsoftTeams.app.initialize().then(() => {
      console.log("Auth-popup initialized. Checking for auth hash...");
      // The authentication provider (Azure AD) redirects to this page.
      // The auth token is in the URL hash (e.g., #code=... or #id_token=...).
      if (window.location.hash) {
        // If a hash is found, it means the login was likely successful.
        // We pass the entire hash string back to the main app window.
        microsoftTeams.authentication.notifySuccess(window.location.hash);
      } else {
        // If there's no hash, it means something went wrong, or the user canceled.
        // We notify the main app of the failure.
        microsoftTeams.authentication.notifyFailure("No authentication hash found in the redirect URL.");
      }
    }).catch((error) => {
        // This catch block handles errors if the Teams SDK fails to initialize.
        console.error("Failed to initialize Teams SDK in auth popup:", error);
        microsoftTeams.authentication.notifyFailure("SDK initialization failed.");
    });
  </script>
</body>
</html>

